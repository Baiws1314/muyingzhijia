"use strict";$(function(){var p=location.search.replace("?","");"undefined"!=p&&$(".n-right li").eq(0).find("a").css("display","none"),$.ajax({type:"get",url:"http://47.104.244.134:8080/cartlist.do",async:!0,data:{token:p},success:function(t){console.log(t);var e="";for(var c in t)e+="<li id="+t[c].id+" gid="+t[c].gid+" cart-id="+t[c].goods.id+'>\n\t\t\t\t\t\t<input class="o-check" type="checkbox"/>\n\t\t\t\t\t\t<a class="pic inblock">\n\t\t\t\t\t\t\t<img src="'+t[c].goods.picurl+'"/>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<span class="title inblock">'+t[c].goods.name+'</span>\n\t\t\t\t\t\t<span class="pri inblock">￥'+t[c].goods.price+'</span>\n\t\t\t\t\t\t<span class="count-a inblock">\n\t\t\t\t\t\t\t<a class="minus">\n\t\t\t\t\t\t\t\t-\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t<p type="text" class="inblock" >'+t[c].count+'</p>\n\t\t\t\t\t\t\t<a class="add">\n\t\t\t\t\t\t\t\t+\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="allPrice inblock">￥'+t[c].goods.price*t[c].count+'</span>\n\t\t\t\t\t\t<span class="action-o inblock">删除</span>\n\t\t\t\t\t</li>',t[c].count,t[c].goods.price*t[c].count;$(".cart-list").html(e),$("#allCheck").prop("checked",!0),$(".o-check").prop("checked",!0);var a=0,i=0;$(".cart-list li input:checked").each(function(){var t=Number($(this).parents("li").find("p").html()),e=Number($(this).parents("li").find(".allPrice").html().replace("￥",""));a+=t,i+=e}),$(".cart-box .heji span").html(a),$(".cart-box .heji em").html("￥"+i),$(".pic,.title").click(function(){var t=$(this).parents("li").attr("cart-id");location.href="detial.html?"+p+"&"+t}),$(".add,.minus,.action-o").click(function(t){var l=t.target;if("add"==l.className)var s=1;else if("minus"==l.className)s=-1;else{if("action-o inblock"!=l.className)return;s=0}var r=$(this).parents("li").attr("id"),o=$(this).parents("li").attr("gid");$.ajax({type:"get",url:"http://47.104.244.134:8080/cartupdate.do",async:!0,data:{id:r,gid:o,num:s,token:p},success:function(t){if(console.log(t),0==t.code){var e=Number($(l).parents("li").find("p").html()),c=Number($(l).parents("li").find(".allPrice").html().replace("￥","")),a=Number($(".cart-box .heji span").html()),i=Number($(".cart-box .heji em").html().replace("￥",""));if(0!=s){$(l).parents("li").find("p").html(e+s);var n=s*Number($(".pri").html().replace("￥",""));$(l).parents("li").find(".allPrice").html("￥"+(c+n)),$(l).parents("li").find("input").prop("checked")&&($(".cart-box .heji span").html(a+s),$(".cart-box .heji em").html("￥"+(i+n)))}else $(l).parents("li").find("input").prop("checked")&&($(".cart-box .heji span").html(a-e),$(".cart-box .heji em").html("￥"+(i-c)));(e+s<=0||0==s)&&($.get("http://47.104.244.134:8080/cartupdate.do",{id:r,gid:o,num:0,token:p}),$(l).parents("li").remove())}else alert("操作失败,请重试")}})}),$("#allCheck").click(function(){$(".o-check").prop("checked",$("#allCheck").prop("checked"))}),$("#allCheck,.o-check").click(function(){$(".cart-list").find("input:checked").length==$(".o-check").length?$("#allCheck").prop("checked",!0):$("#allCheck").prop("checked",!1);var c=0,a=0;$(".cart-list li input:checked").each(function(){var t=Number($(this).parents("li").find("p").html()),e=Number($(this).parents("li").find(".allPrice").html().replace("￥",""));c+=t,a+=e}),$(".cart-box .heji span").html(c),$(".cart-box .heji em").html("￥"+a)})}})});