"use strict";$(function(){var p=location.search.replace("?","");"undefined"!=p&&$(".n-right li").eq(0).find("a").css("display","none"),$.ajax({type:"get",url:"http://47.104.244.134:8080/cartlist.do",async:!0,data:{token:p},success:function(t){console.log(t);var a="",n=0,s=0;for(var i in t)a+="<li id="+t[i].id+" gid="+t[i].gid+'>\n\t\t\t\t\t\t<a class="pic inblock">\n\t\t\t\t\t\t\t<img src="'+t[i].goods.picurl+'"/>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<span class="title inblock">'+t[i].goods.name+'</span>\n\t\t\t\t\t\t<span class="pri inblock">￥'+t[i].goods.price+'</span>\n\t\t\t\t\t\t<span class="count-a inblock">\n\t\t\t\t\t\t\t<a class="minus">\n\t\t\t\t\t\t\t\t-\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t<p type="text" class="inblock" >'+t[i].count+'</p>\n\t\t\t\t\t\t\t<a class="add">\n\t\t\t\t\t\t\t\t+\n\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="allPrice inblock">￥'+t[i].goods.price*t[i].count+'</span>\n\t\t\t\t\t\t<span class="action-o inblock">删除</span>\n\t\t\t\t\t</li>',n+=t[i].count,s+=t[i].goods.price*t[i].count;$(".cart-list").html(a),$(".cart-box>p span").html(n),$(".cart-box>p em").html("￥"+s),$(".pic,.title").click(function(){var t=$(this).parents("li").attr("id");location.href="detial.html?"+t}),$(".add,.minus,.action-o").click(function(t){var e=t.target;if("add"==t.target.className)var l=1;else if("minus"==t.target.className)l=-1;else{if("action-o inblock"!=t.target.className)return;l=0}var r=$(this).parents("li").attr("id"),o=$(this).parents("li").attr("gid");$.ajax({type:"get",url:"http://47.104.244.134:8080/cartupdate.do",async:!0,data:{id:r,gid:o,num:l,token:p},success:function(t){if(console.log(t),0==t.code){var a=Number($(e).parent().find("p").html());$(e).parent().find("p").html(a+l);var n=Number($(".cart-box>p span").html()),s=l*Number($(".pri").html().replace("￥","")),i=Number($(".cart-box>p em").html().replace("￥","")),c=Number($(e).parent().siblings(".allPrice").html().replace("￥",""));$(e).parent().siblings(".allPrice").html("￥"+(c+s)),$(".cart-box>p span").html(n+l),$(".cart-box>p em").html("￥"+(i+s)),a+l<=0&&($.get("http://47.104.244.134:8080/cartupdate.do",{id:r,gid:o,num:0,token:p}),$(e).parents("li").remove())}else alert("操作失败,请重试")}})})}})});